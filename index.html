<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Happy Communicator</title>
  <style>
    /* Global Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
      color: #333;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    /* Container Boxes */
    .container {
      background: #fff;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      max-width: 600px;
      width: 100%;
      text-align: center;
    }
    .hidden {
      display: none;
    }
    /* Buttons */
    button {
      background: #0077cc;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      margin: 10px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    button:hover {
      background: #005fa3;
    }
    /* Text Inputs */
    textarea, input[type="text"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    textarea {
      resize: none;
      height: 80px;
    }
    /* Drag & Drop Puzzle Styles */
    #puzzleContainer {
      list-style: none;
      padding: 0;
      margin: 20px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    #puzzleContainer li {
      background: #f0f8ff;
      border: 2px solid #0077cc;
      border-radius: 5px;
      padding: 10px 15px;
      margin: 5px;
      cursor: move;
      font-weight: bold;
      user-select: none;
      transition: background 0.3s, transform 0.3s;
    }
    #puzzleContainer li.dragging {
      opacity: 0.5;
      transform: scale(1.05);
    }
    /* Success Message */
    #successMessage {
      font-size: 20px;
      font-weight: bold;
      color: #2e7d32;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- Landing Page -->
  <div id="landing" class="container">
    <h1>The Happy Communicator</h1>
    <p>Welcome! Not just a chatâ€”unlock the secret message through a fun puzzle!</p>
    <button id="gfBtn">I'm the Girlfriend</button>
    <button id="bfBtn">I'm the Boyfriend</button>
  </div>

  <!-- Girlfriend Section -->
  <div id="girlfriendSection" class="container hidden">
    <h2>Girlfriend Input</h2>
    <textarea id="messageInput" placeholder="Enter your positive secret message..."></textarea>
    <button id="submitMessage">Submit Message</button>
  </div>

  <!-- Boyfriend Section -->
  <div id="boyfriendSection" class="container hidden">
    <h2>Decode the Message</h2>
    <p>Reorder the words to reveal her secret message!</p>
    <ul id="puzzleContainer"></ul>
    <button id="checkOrder">Check Order</button>
    <div id="successMessage" class="hidden"></div>
  </div>

  <script>
    /* -------------------------
       Utility Functions
    -------------------------- */
    // Simple shuffle function
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Function to save message to localStorage
    function saveMessage(message) {
      localStorage.setItem("happyMessage", message);
    }

    // Function to load message from localStorage
    function loadMessage() {
      return localStorage.getItem("happyMessage") || "";
    }

    /* -------------------------
       DOM Elements
    -------------------------- */
    const landing = document.getElementById("landing");
    const gfBtn = document.getElementById("gfBtn");
    const bfBtn = document.getElementById("bfBtn");

    const girlfriendSection = document.getElementById("girlfriendSection");
    const messageInput = document.getElementById("messageInput");
    const submitMessage = document.getElementById("submitMessage");

    const boyfriendSection = document.getElementById("boyfriendSection");
    const puzzleContainer = document.getElementById("puzzleContainer");
    const checkOrder = document.getElementById("checkOrder");
    const successMessage = document.getElementById("successMessage");

    /* -------------------------
       Landing Page Logic
    -------------------------- */
    gfBtn.addEventListener("click", () => {
      landing.classList.add("hidden");
      girlfriendSection.classList.remove("hidden");
    });

    bfBtn.addEventListener("click", () => {
      landing.classList.add("hidden");
      boyfriendSection.classList.remove("hidden");
      initPuzzle();
    });

    /* -------------------------
       Girlfriend Submission Logic
    -------------------------- */
    submitMessage.addEventListener("click", () => {
      const msg = messageInput.value.trim();
      if (msg === "") {
        alert("Please enter a message!");
        return;
      }
      saveMessage(msg);
      alert("Your message has been saved!");
      girlfriendSection.classList.add("hidden");
      landing.classList.remove("hidden");
    });

    /* -------------------------
       Boyfriend Puzzle Logic
    -------------------------- */
    let originalMessage = "";
    let scrambledWords = [];

    // Initialize the puzzle on boyfriend side
    function initPuzzle() {
      originalMessage = loadMessage();
      if (!originalMessage) {
        alert("No message available. Ask your girlfriend to submit a message first!");
        location.reload();
        return;
      }
      // Split the message into words
      const words = originalMessage.split(" ").filter(w => w);
      // Create a scrambled copy
      scrambledWords = shuffleArray([...words]);
      // Render the draggable list
      renderPuzzle();
    }

    // Render puzzle words as list items
    function renderPuzzle() {
      puzzleContainer.innerHTML = "";
      scrambledWords.forEach((word, index) => {
        const li = document.createElement("li");
        li.setAttribute("draggable", "true");
        li.dataset.index = index;
        li.textContent = word;
        puzzleContainer.appendChild(li);
      });
      addDragAndDrop();
    }

    // Drag and Drop Implementation
    function addDragAndDrop() {
      const draggables = document.querySelectorAll("#puzzleContainer li");
      let draggedItem = null;
      
      draggables.forEach(item => {
        item.addEventListener("dragstart", () => {
          draggedItem = item;
          item.classList.add("dragging");
        });
        item.addEventListener("dragend", () => {
          draggedItem = null;
          item.classList.remove("dragging");
        });
      });
      
      puzzleContainer.addEventListener("dragover", (e) => {
        e.preventDefault();
        const afterElement = getDragAfterElement(puzzleContainer, e.clientY);
        if (afterElement == null) {
          puzzleContainer.appendChild(draggedItem);
        } else {
          puzzleContainer.insertBefore(draggedItem, afterElement);
        }
      });
    }

    // Helper function to get the element after the current drag position
    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll("li:not(.dragging)")];
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    // Check if the current order matches the original message
    checkOrder.addEventListener("click", () => {
      const currentOrder = Array.from(puzzleContainer.children).map(li => li.textContent.trim());
      if (currentOrder.join(" ") === originalMessage) {
        successMessage.textContent = "Success! The decoded message is: " + originalMessage;
        successMessage.classList.remove("hidden");
        puzzleContainer.classList.add("hidden");
        checkOrder.classList.add("hidden");
      } else {
        alert("Not quite right! Rearrange the words and try again.");
      }
    });
  </script>
</body>
</html>
